<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="正睿暑期AB班 题解"><meta name="keywords" content=""><meta name="author" content="hydd"><meta name="copyright" content="hydd"><title>正睿暑期AB班 题解 | hydd's blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.8.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.8.2"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="hydd's blog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#day1"><span class="toc-number">1.</span> <span class="toc-text">day1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#B"><span class="toc-number">1.1.</span> <span class="toc-text">B</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A"><span class="toc-number">1.2.</span> <span class="toc-text">A</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day2"><span class="toc-number">2.</span> <span class="toc-text">day2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C"><span class="toc-number">2.1.</span> <span class="toc-text">C</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-1"><span class="toc-number">2.2.</span> <span class="toc-text">A</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day3"><span class="toc-number">3.</span> <span class="toc-text">day3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-2"><span class="toc-number">3.1.</span> <span class="toc-text">A</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-1"><span class="toc-number">3.2.</span> <span class="toc-text">C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day4"><span class="toc-number">4.</span> <span class="toc-text">day4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C-2"><span class="toc-number">4.1.</span> <span class="toc-text">C</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B-1"><span class="toc-number">4.2.</span> <span class="toc-text">B</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-3"><span class="toc-number">4.3.</span> <span class="toc-text">A</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day10"><span class="toc-number">5.</span> <span class="toc-text">day10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C-3"><span class="toc-number">5.1.</span> <span class="toc-text">C</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">hydd</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">29</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">11</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1601458971422&amp;di=b8daa23ca0b94063c28207d10326c892&amp;imgtype=0&amp;src=http%3A%2F%2Fattach.bbs.miui.com%2Fforum%2F201412%2F14%2F202225id4jvijttjt6ffjs.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">hydd's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/template">Template</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">正睿暑期AB班 题解</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-08-07</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/NOI%E6%A8%A1%E6%8B%9F%E8%B5%9B/">NOI模拟赛</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h1><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><ul>
<li>某奇怪的论文？<a target="_blank" rel="noopener" href="https://www.academia.edu/7310919/Enumeration_of_0_1_matrices_avoiding_some_2x2_matrices。相当于原矩形不存在论文第一页中的">https://www.academia.edu/7310919/Enumeration_of_0_1_matrices_avoiding_some_2x2_matrices。相当于原矩形不存在论文第一页中的</a> $I$ 这个子矩阵（这里的子矩阵不需要连续，相当于选定 $x_1\neq x_2,y_1\neq y_2$，组合得到的 $4$ 个点就是子矩阵）。那么 Proposition2.2 中的 $B_n^{-k}$ 即为答案。</li>
<li>$NTT$ 求出斯特林数即可。</li>
<li>时间复杂度 $O(n\log n)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:W2B</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/28</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> g=<span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">1100000</span>;</span><br><span class="line">ll fac[MAXN],inv[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qpow</span><span class="params">(ll x,<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (a)&#123;</span><br><span class="line">		<span class="keyword">if</span> (a&amp;<span class="number">1</span>) res=res*x%Mod;</span><br><span class="line">		x=x*x%Mod; a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> n,m,N,len,rev[MAXN];</span><br><span class="line">	ll a[MAXN],b[MAXN],c[MAXN];</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getinv</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> qpow(x,Mod<span class="number">-2</span>);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(ll *a,<span class="keyword">int</span> inv)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">			<span class="keyword">if</span> (i&lt;rev[i]) swap(a[i],a[rev[i]]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> mid=<span class="number">1</span>;mid&lt;n;mid&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">int</span> tmp=qpow(g,(Mod<span class="number">-1</span>)/(mid&lt;&lt;<span class="number">1</span>));</span><br><span class="line">			<span class="keyword">if</span> (inv==<span class="number">-1</span>) tmp=getinv(tmp);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i+=mid*<span class="number">2</span>)&#123;</span><br><span class="line">				ll omega=<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">for</span> (ll j=<span class="number">0</span>;j&lt;mid;j++,omega=omega*tmp%Mod)&#123;</span><br><span class="line">					<span class="keyword">int</span> x=a[i+j],y=omega*a[i+j+mid]%Mod;</span><br><span class="line">					a[i+j]=(x+y)%Mod,a[i+j+mid]=(x-y+Mod)%Mod;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> nnn)</span></span>&#123;</span><br><span class="line">		n=nnn+<span class="number">1</span>; N=n;</span><br><span class="line">		ll op=<span class="number">1</span>,mul=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span> (i) mul=mul*i%Mod;</span><br><span class="line">			ll inv=getinv(mul);</span><br><span class="line">			a[i]=inv*op%Mod;</span><br><span class="line">			b[i]=qpow(i,n<span class="number">-1</span>)*inv%Mod;</span><br><span class="line">			op=Mod-op;</span><br><span class="line">		&#125;</span><br><span class="line">		len=(n&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">int</span> bit=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> ((<span class="number">1</span>&lt;&lt;bit)&lt;len) bit++;</span><br><span class="line">		n=<span class="number">1</span>&lt;&lt;bit;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) rev[i]=(rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(bit<span class="number">-1</span>));</span><br><span class="line">		NTT(a,<span class="number">1</span>); NTT(b,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) a[i]=a[i]*b[i]%Mod;</span><br><span class="line">		NTT(a,<span class="number">-1</span>);</span><br><span class="line">		ll inv=getinv(n);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) c[i]=a[i]*inv%Mod;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; tmp1,tmp2;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	tmp1.main(n+<span class="number">1</span>); tmp2.main(m+<span class="number">1</span>);</span><br><span class="line">	fac[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=min(n,m)+<span class="number">1</span>;i++) fac[i]=fac[i<span class="number">-1</span>]*i%Mod;</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;=min(n,m);k++)</span><br><span class="line">		ans=(ans+fac[k]*fac[k]%Mod*tmp1.c[k+<span class="number">1</span>]%Mod*tmp2.c[k+<span class="number">1</span>])%Mod;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><ul>
<li>不难发现积水的区域形成了⼀个树状结构，树上的每个节点对应着⼀个连通块。每个区间都有⼀个高度范围，具体来说，范围是[该区间内的最大海拔，父区间的最大海拔]。 不难发现海绵一定放在叶子结点最优，所以海绵吸⾛的是⼀条从叶子到根的路径上的水。</li>
<li>问题相当于每次操作可以删去某个叶子到根的所有数字，要求删的数的和尽量大。删的⼀定是长链剖分上的⼀条链。若从高到低求树状结构，需要维护删去格子后的连通性，不好做。考虑从低到高加入格子，用并查集维护连通块，这样可以很方便地得知当前格子将哪些连通块并成了⼀个大连通块。</li>
<li>复杂度 $O(nm\log nm)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:H2O</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/28</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> File(x) freopen(x<span class="meta-string">&quot;.in&quot;</span>,<span class="meta-string">&quot;r&quot;</span>,stdin);freopen(x<span class="meta-string">&quot;.out&quot;</span>,<span class="meta-string">&quot;w&quot;</span>,stdout);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n,m,K,fa[<span class="number">1100000</span>],sz[<span class="number">1100000</span>],mxdep[<span class="number">1100000</span>];</span><br><span class="line"><span class="keyword">int</span> cnt; ll sum[<span class="number">1100000</span>],a[<span class="number">1100000</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; son[<span class="number">1100000</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">hs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123; <span class="keyword">return</span> (x<span class="number">-1</span>)*m+y;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findset</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x!=fa[x]) fa[x]=findset(fa[x]);</span><br><span class="line">	<span class="keyword">return</span> fa[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Union</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> y,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">	y=findset(y);</span><br><span class="line">	<span class="keyword">if</span> (x==y) <span class="keyword">return</span>;</span><br><span class="line">	sum[y]+=<span class="number">1l</span>l*sz[y]*(d-mxdep[y]); mxdep[y]=d;</span><br><span class="line">	<span class="keyword">if</span> (sum[y]&gt;sum[x])&#123; <span class="keyword">int</span> tmp=x; x=y; y=tmp;&#125;</span><br><span class="line">	<span class="keyword">if</span> (sum[x]) a[++cnt]=sum[y];</span><br><span class="line">	fa[y]=x; sz[x]+=sz[y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;K);</span><br><span class="line">	<span class="keyword">int</span> u,mx=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;u);</span><br><span class="line">			son[u].push_back(hs(i,j));</span><br><span class="line">			mx=max(mx,u);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=mx;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> u:son[i])&#123;</span><br><span class="line">			<span class="keyword">int</span> x=(u<span class="number">-1</span>)/m+<span class="number">1</span>,y=(u<span class="number">-1</span>)%m+<span class="number">1</span>;</span><br><span class="line">			mxdep[u]=i; fa[u]=u;</span><br><span class="line">			<span class="keyword">int</span> nx,ny;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">4</span>;k++)&#123;</span><br><span class="line">				nx=x+dx[k]; ny=y+dy[k];</span><br><span class="line">				<span class="keyword">if</span> (nx&lt;<span class="number">1</span>||nx&gt;n||ny&lt;<span class="number">1</span>||ny&gt;m||!mxdep[hs(nx,ny)]) <span class="keyword">continue</span>;</span><br><span class="line">				Union(u,hs(nx,ny),i);</span><br><span class="line">			&#125;</span><br><span class="line">			sz[u]++;</span><br><span class="line">		&#125;</span><br><span class="line">	sort(a+<span class="number">1</span>,a+cnt+<span class="number">1</span>,greater&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=cnt;i&gt;=<span class="number">1</span>;i--) a[i]+=a[i+<span class="number">1</span>];</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=K&amp;&amp;i&lt;=cnt;i++) ans^=a[i];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h1><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><ul>
<li>写了很长时间的遗传，发现只有 $80pts$（而且 $7,8$ 跑了 $1000s$）。</li>
<li>然后发现暴力就可过？就是可以依次枚举，过程中记录每个点还能用哪些颜色。可以从度数大的开始枚举，这样得到的信息就比较多，每个位置可用颜色就比较少。然后就过了。</li>
<li>正解是先随机赋颜色。然后不停调整点的颜色使同色边尽可能小，有多种方案随机选。（如果长时间调整不出可以多换几个点的颜色，个人认为还是类似于遗传中的变异？）但由于数据水，不需要调整就过了。</li>
</ul>
<h2 id="A-1"><a href="#A-1" class="headerlink" title="A"></a>A</h2><ul>
<li>先讲讲一种奇怪的做法。</li>
<li>首先，我们考虑 $l$ 的答案，先将它往左延伸直到不能延伸，设延伸到了 $x$，然后再看后面能有多少个位置也可以加入，设加到了 $r$。</li>
<li>延伸的过程就是只要和当前的 $p$ 有一维相等，就延伸。否则若 $p$ 还有未确定的维，就选一个维，将它赋值成现在这个点的那一维。没有的话就不能延伸了。</li>
<li>那么 $[l,r]$ 为右端点的段最长只能到最左边的 $x$。然后继续考虑 $r+1$ 。</li>
<li>可以发现 $x$ 不会小于上一次的 $l$，所以每个段最多会经过两次（当前用 $r$ 经过一次，下一次用 $x$ 经过一次）。</li>
<li>时间复杂度 $O(n k! k)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:stars</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/29</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> File(x) freopen(x<span class="meta-string">&quot;.in&quot;</span>,<span class="meta-string">&quot;r&quot;</span>,stdin);freopen(x<span class="meta-string">&quot;.out&quot;</span>,<span class="meta-string">&quot;w&quot;</span>,stdout);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n,K,a[<span class="number">110000</span>][<span class="number">6</span>],num[<span class="number">110000</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">		<span class="keyword">if</span> (a[u][i]==num[i]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getl</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!u) <span class="keyword">return</span> u;</span><br><span class="line">	<span class="keyword">if</span> (check(u)) <span class="keyword">return</span> getl(u<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">int</span> ans=u;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">		<span class="keyword">if</span> (num[i]==<span class="number">-1</span>)&#123;</span><br><span class="line">			num[i]=a[u][i];</span><br><span class="line">			ans=min(ans,getl(u<span class="number">-1</span>));</span><br><span class="line">			num[i]=<span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getr</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (u==n+<span class="number">1</span>) <span class="keyword">return</span> u;</span><br><span class="line">	<span class="keyword">if</span> (check(u)) <span class="keyword">return</span> getr(u+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> ans=u;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">		<span class="keyword">if</span> (num[i]==<span class="number">-1</span>)&#123;</span><br><span class="line">			num[i]=a[u][i];</span><br><span class="line">			ans=max(ans,getr(u+<span class="number">1</span>));</span><br><span class="line">			num[i]=<span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;K);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;K;j++)</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i][j]);</span><br><span class="line">	<span class="built_in">memset</span>(num,<span class="number">-1</span>,<span class="keyword">sizeof</span>(num));</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> l=<span class="number">1</span>,r;l&lt;=n;l=r+<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> x=getl(l)+<span class="number">1</span>;</span><br><span class="line">		r=getr(x)<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=l;i&lt;=r;i++) ans+=(<span class="number">1l</span>l*(<span class="number">1</span>+i-x+<span class="number">1</span>)*(i-x+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>正解就是一个 $dp$，比较复杂，就不详细讲了。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:stars</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/29</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">110000</span>][<span class="number">5</span>],vis[<span class="number">110000</span>],dp[<span class="number">110000</span>][<span class="number">410</span>],cnt;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Now,p[<span class="number">410</span>],vec_S[<span class="number">410</span>],vec_SrT[<span class="number">410</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	p[cnt++]=Now;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)</span><br><span class="line">		<span class="keyword">if</span> (!vis[i])&#123;</span><br><span class="line">			vis[i]=<span class="literal">true</span>; Now.push_back(i);</span><br><span class="line">			dfs(k);</span><br><span class="line">			vis[i]=<span class="literal">false</span>; Now.pop_back();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i][j]);</span><br><span class="line">	dfs(m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;cnt;i++)&#123;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; S,SrT=p[i];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;(<span class="keyword">int</span>)p[i].size();j++)&#123;</span><br><span class="line">			vec_S[i].push_back(find(p,p+cnt,S)-p);</span><br><span class="line">			vec_SrT[i].push_back(find(p,p+cnt,SrT)-p);</span><br><span class="line">			<span class="keyword">if</span> (j&lt;(<span class="keyword">int</span>)p[i].size()<span class="number">-1</span>) swap(SrT[j],SrT[j+<span class="number">1</span>]);</span><br><span class="line">			S.push_back(SrT[j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;cnt;i++) dp[n+<span class="number">1</span>][i]=n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=n;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">int</span> r=i; dp[i][<span class="number">0</span>]=i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;cnt;j++)&#123;</span><br><span class="line">			<span class="keyword">int</span> flg=<span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;(<span class="keyword">int</span>)p[j].size()&amp;&amp;!flg;k++)</span><br><span class="line">				<span class="keyword">if</span> (a[i][p[j][<span class="number">0</span>]]==a[dp[i+<span class="number">1</span>][vec_S[j][k]]][p[j][<span class="number">0</span>]])&#123;</span><br><span class="line">					dp[i][j]=dp[i+<span class="number">1</span>][vec_SrT[j][k]];</span><br><span class="line">					flg=<span class="literal">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">if</span> (!flg) dp[i][j]=dp[i+<span class="number">1</span>][vec_S[j].back()];</span><br><span class="line">			r=max(r,dp[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">		ans+=(<span class="number">1l</span>l*(r-i)*(r-i+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="day3"><a href="#day3" class="headerlink" title="day3"></a>day3</h1><h2 id="A-2"><a href="#A-2" class="headerlink" title="A"></a>A</h2><ul>
<li>直接笛卡尔树，然后将前缀和取模加入哈希表。</li>
<li>每次枚举笛卡尔树上较短的一边，枚举答案，查询需要的值是不是在较大的一边出现即可。</li>
<li>时间复杂度 $O(n\log^2 n)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:Good Subsegments</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/30</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> File(x) freopen(x<span class="meta-string">&quot;.in&quot;</span>,<span class="meta-string">&quot;r&quot;</span>,stdin);freopen(x<span class="meta-string">&quot;.out&quot;</span>,<span class="meta-string">&quot;w&quot;</span>,stdout);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll Mod=<span class="number">1000000000000000003l</span>l;</span><br><span class="line"><span class="keyword">int</span> n,ans,a[<span class="number">210000</span>],pos[<span class="number">20</span>][<span class="number">210000</span>],Log2[<span class="number">210000</span>];</span><br><span class="line">ll b[<span class="number">210000</span>],sum[<span class="number">210000</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> hashMod=<span class="number">800009</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hashMap</span>&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">		ll v; <span class="keyword">int</span> p;</span><br><span class="line">		node()&#123;&#125;</span><br><span class="line">		node(ll vv,<span class="keyword">int</span> pp)&#123; v=vv; p=pp;&#125;</span><br><span class="line">	&#125; vet[<span class="number">210000</span>];</span><br><span class="line">	<span class="keyword">int</span> edgenum,Next[<span class="number">210000</span>],Head[hashMod];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(ll v,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> u=v%hashMod;</span><br><span class="line">		vet[++edgenum]=node(v,p);</span><br><span class="line">		Next[edgenum]=Head[u];</span><br><span class="line">		Head[u]=edgenum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> u=x%hashMod;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> e=Head[u];e;e=Next[e])</span><br><span class="line">			<span class="keyword">if</span> (vet[e].v==x) <span class="keyword">return</span> vet[e].p;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; S;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">add</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x+y&gt;=Mod) <span class="keyword">return</span> x+y-Mod;</span><br><span class="line">	<span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">dec</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x&lt;y) <span class="keyword">return</span> x-y+Mod;</span><br><span class="line">	<span class="keyword">return</span> x-y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">mul</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">	ll ret=x*y-((ll)((<span class="keyword">long</span> <span class="keyword">double</span>)x/Mod*y+<span class="number">0.5</span>))*Mod;</span><br><span class="line">	<span class="keyword">return</span> (ret%Mod+Mod)%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RMQ_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) pos[<span class="number">0</span>][i]=i;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j)&lt;=n;j++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=n;i++)</span><br><span class="line">			<span class="keyword">if</span> (a[pos[j<span class="number">-1</span>][i]]&gt;a[pos[j<span class="number">-1</span>][i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))]]) pos[j][i]=pos[j<span class="number">-1</span>][i];</span><br><span class="line">			<span class="keyword">else</span> pos[j][i]=pos[j<span class="number">-1</span>][i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">RMQ_query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> k=Log2[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">if</span> (a[pos[k][l]]&gt;a[pos[k][r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>]]) <span class="keyword">return</span> pos[k][l];</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> pos[k][r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (a)&#123;</span><br><span class="line">		<span class="keyword">if</span> (a&amp;<span class="number">1</span>) res=mul(res,x);</span><br><span class="line">		x=mul(x,x); a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) ans++;</span><br><span class="line">	<span class="keyword">if</span> (l&gt;=r) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> x=RMQ_query(l,r);</span><br><span class="line">	<span class="keyword">if</span> (x-l&lt;r-x)&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=x;i&gt;=l;i--)&#123;</span><br><span class="line">			ll p=b[x],tmp; <span class="keyword">int</span> loc;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">19</span>;j++)&#123;</span><br><span class="line">				tmp=add(p,sum[i<span class="number">-1</span>]);</span><br><span class="line">				loc=S.find(tmp)<span class="number">-1</span>;</span><br><span class="line">				<span class="keyword">if</span> (x&lt;=loc&amp;&amp;loc&lt;=r) ans++;</span><br><span class="line">				p=add(p,p);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=x;i&lt;=r;i++)&#123;</span><br><span class="line">			ll p=b[x],tmp; <span class="keyword">int</span> loc;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">19</span>;j++)&#123;</span><br><span class="line">				tmp=dec(sum[i],p);</span><br><span class="line">				loc=S.find(tmp);</span><br><span class="line">				<span class="keyword">if</span> (l&lt;=loc&amp;&amp;loc&lt;=x) ans++;</span><br><span class="line">				p=add(p,p);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	solve(l,x<span class="number">-1</span>); solve(x+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	Log2[<span class="number">1</span>]=<span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">200000</span>;i++) Log2[i]=Log2[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">	S.ins(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]); b[i]=qpow(<span class="number">2</span>,a[i]);</span><br><span class="line">		sum[i]=add(sum[i<span class="number">-1</span>],b[i]); S.ins(sum[i],i+<span class="number">1</span>);</span><br><span class="line"><span class="comment">//		printf(&quot;%d\n&quot;,S.find(sum[i]));</span></span><br><span class="line">	&#125;</span><br><span class="line">	RMQ_init();</span><br><span class="line">	solve(<span class="number">1</span>,n);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><ul>
<li>最优状态只能是 $(1,\frac{n+1}2+1),(2,\frac{n+1}2+2),\cdots,(\frac{n-1}2,n)$ 它们之间连边。</li>
<li>答案随便算即可。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:Funny Cost</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/30</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> File(x) freopen(x<span class="meta-string">&quot;.in&quot;</span>,<span class="meta-string">&quot;r&quot;</span>,stdin);freopen(x<span class="meta-string">&quot;.out&quot;</span>,<span class="meta-string">&quot;w&quot;</span>,stdout);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[<span class="number">210000</span>];</span><br><span class="line">ll fac[<span class="number">210000</span>],inv[<span class="number">210000</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">C</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n&lt;m) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> fac[n]*inv[m]%Mod*inv[n-m]%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fac[<span class="number">0</span>]=<span class="number">1</span>; <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">200000</span>;i++) fac[i]=fac[i<span class="number">-1</span>]*i%Mod;</span><br><span class="line">	inv[<span class="number">1</span>]=<span class="number">1</span>; <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">200000</span>;i++) inv[i]=(Mod-Mod/i)*inv[Mod%i]%Mod;</span><br><span class="line">	inv[<span class="number">0</span>]=<span class="number">1</span>; <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">200000</span>;i++) inv[i]=inv[i<span class="number">-1</span>]*inv[i]%Mod;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">	sort(a+<span class="number">1</span>,a+n+<span class="number">1</span>); ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) ans=(ans+<span class="number">1l</span>l*C(i<span class="number">-1</span>,(n<span class="number">-1</span>)/<span class="number">2</span>)*a[i])%Mod;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="number">1l</span>l*fac[(n+<span class="number">1</span>)/<span class="number">2</span>]*fac[(n+<span class="number">1</span>)/<span class="number">2</span>]%Mod*ans%Mod);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="day4"><a href="#day4" class="headerlink" title="day4"></a>day4</h1><h2 id="C-2"><a href="#C-2" class="headerlink" title="C"></a>C</h2><ul>
<li>我们选择一个素数 $p$，若 $i,j$ 不满足 $x_ix_j+y_iy_j\equiv k\pmod p$ ，那么必没有 $x_ix_j+y_iy_j=k$。</li>
<li>先求出满足 $0\leq a,b,c,d&lt;p$ 的四元组 $(a,b,c,d)$，那么若有 $x_ix_j+y_iy_j\equiv k\pmod p$，必存在 $a,b,c,d$，满足 $(x_i\bmod p,y_i\bmod p,x_j\bmod p,y_j\bmod p)=(a,b,c,d)$ 。</li>
<li>那么，我们将所有 $(x_i\bmod p,y_i\bmod p)$ 加入数组。然后枚举所有 $(a,b,c,d)$，对于 $(x_i\bmod p,y_i\bmod p)=(a,b),(x_j\bmod p,y_i\bmod p)=(c,d)$ 再暴力判断。</li>
<li>尝试可以发现 $p=97$ 较优。注意，不需要枚举 $d$，因为 $d\equiv -\frac{ac}b \pmod b$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:Exercise</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/31</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> File(x) freopen(x<span class="meta-string">&quot;.in&quot;</span>,<span class="meta-string">&quot;r&quot;</span>,stdin);freopen(x<span class="meta-string">&quot;.out&quot;</span>,<span class="meta-string">&quot;w&quot;</span>,stdout);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod=<span class="number">97</span>;</span><br><span class="line"><span class="keyword">int</span> n,A[<span class="number">210000</span>],B[<span class="number">210000</span>];</span><br><span class="line"><span class="keyword">int</span> edgenum,vet[<span class="number">210000</span>],Next[<span class="number">210000</span>],Head[Mod*Mod];</span><br><span class="line">ll k;</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">Getchar</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">char</span> now[<span class="number">1</span>&lt;&lt;<span class="number">20</span>],*S,*T;</span><br><span class="line">	<span class="keyword">if</span> (T==S)&#123;</span><br><span class="line">		T=(S=now)+fread(now,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">20</span>,<span class="built_in">stdin</span>);</span><br><span class="line">		<span class="keyword">if</span> (T==S) <span class="keyword">return</span> EOF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> *S++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">char</span> ch=Getchar();</span><br><span class="line">	<span class="keyword">while</span> (ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>;</span><br><span class="line">		ch=Getchar();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (ch&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;ch&gt;=<span class="string">&#x27;0&#x27;</span>) x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>,ch=Getchar();</span><br><span class="line">	<span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">readll</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll x=<span class="number">0</span>,f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">char</span> ch=Getchar();</span><br><span class="line">	<span class="keyword">while</span> (ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>;</span><br><span class="line">		ch=Getchar();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (ch&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;ch&gt;=<span class="string">&#x27;0&#x27;</span>) x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>,ch=Getchar();</span><br><span class="line">	<span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!y) <span class="keyword">return</span> x;</span><br><span class="line">	<span class="keyword">return</span> gcd(y,x%y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">hs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x%Mod*Mod+y%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	vet[++edgenum]=v;</span><br><span class="line">	Next[edgenum]=Head[u];</span><br><span class="line">	Head[u]=edgenum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (a)&#123;</span><br><span class="line">        <span class="keyword">if</span> (a&amp;<span class="number">1</span>) res=res*x%Mod;</span><br><span class="line">        x=x*x%Mod; a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ((a*c+b*d)%Mod!=k%Mod) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> p=a*Mod+b,q=c*Mod+d,x,y;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=Head[p];u;u=Next[u])</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> v=Head[q];v;v=Next[v])&#123;</span><br><span class="line">			x=vet[u]; y=vet[v];</span><br><span class="line">			<span class="keyword">if</span> (<span class="number">1l</span>l*A[x]*A[y]+<span class="number">1l</span>l*B[x]*B[y]==k)&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,x,y);</span><br><span class="line">				<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;Mod;++a)&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b=<span class="number">1</span>;b&lt;Mod;++b)</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>;c&lt;Mod;++c)&#123;</span><br><span class="line">				<span class="keyword">int</span> d=(<span class="number">1l</span>l*(k%Mod-a*c)*qpow(b,Mod<span class="number">-2</span>)%Mod+Mod)%Mod;</span><br><span class="line">				calc(a,b,c,d);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">int</span> b=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>;c&lt;Mod;++c)</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> d=<span class="number">0</span>;d&lt;Mod;++d)</span><br><span class="line">				calc(a,b,c,d);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//	File(&quot;data2&quot;);</span></span><br><span class="line">	n=read(); k=readll();</span><br><span class="line">	<span class="keyword">int</span> g;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		A[i]=read(); B[i]=read();</span><br><span class="line">		g=gcd(A[i],B[i]);</span><br><span class="line">		<span class="keyword">if</span> (k%g) <span class="keyword">continue</span>;</span><br><span class="line">		addedge(hs(A[i],B[i]),i);</span><br><span class="line">	&#125;</span><br><span class="line">	work();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="B-1"><a href="#B-1" class="headerlink" title="B"></a>B</h2><ul>
<li>首先我们设 $dp_i$ 表示前 $i$ 个数分段排好序的最小代价，$dp_i=x+\min_{j&lt;i}dp_j+calc(j+1,i)$。（其中 $calc(l,r)$ 表示 $a_l,a_{l+1},\cdots,a_r$ 的逆序对数。</li>
<li>首先，根据 $dp$ 的定义，可以显然的发现决策单调性。证明的话可以直接考虑所有 $dp_j(j&lt;i)$ 的 $dp_i$ 的贡献，显然随着 $i$ 增大，$\Delta dp_1\geq \Delta dp_2\geq \cdots \geq \Delta dp_{i-1}$。那么显然是决策单调的。</li>
<li>但是，由于是 $1D$ 的 $dp$，后面的 $dp$ 值依赖前面的 $dp$ 值。但是我们可以类似于分治 $FFT$ 那样，外面套一层 $CDQ$ 分治，再递归的过程中，求出了 $[l,mid]$ 的 $dp$ 值，先将 $[mid+1,r]$ 通过 $[l,mid]$ 更新，然后继续递归 $[mid+1,r]$ 求出 $dp$ 值。 $[mid+1,r]$ 通过 $[l,mid]$ 更新的时候，前面的 $dp$ 值就已经算出来了，可以直接分治。</li>
<li>维护逆序对数可以类似于莫队一样的移动，可以证明移动的步数是 $O(n\log n)$ 级别。每次移动暴力树状数组插入删除，时间复杂度 $O(\log n)$。</li>
<li>总时间复杂度 $O(n \log^3 n)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:Dispatch Money</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/7/31</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> File(x) freopen(x<span class="meta-string">&quot;.in&quot;</span>,<span class="meta-string">&quot;r&quot;</span>,stdin);freopen(x<span class="meta-string">&quot;.out&quot;</span>,<span class="meta-string">&quot;w&quot;</span>,stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADD_Left() L--,num+=R-L-query(p[L]),add(p[L],1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADD_Right() R++,num+=query(p[R]),add(p[R],1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEL_Left() add(p[L],-1),num-=R-L-query(p[L]),L++;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEL_Right() add(p[R],-1),num-=query(p[R]),R--;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll INF=<span class="number">1l</span>l&lt;&lt;<span class="number">60</span>;</span><br><span class="line"><span class="keyword">int</span> n,k,p[<span class="number">310000</span>],tree[<span class="number">310000</span>];</span><br><span class="line"><span class="keyword">int</span> L,R; ll num,f[<span class="number">310000</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (;x;x-=x&amp;-x) tree[x]+=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (;x&lt;=n;x+=x&amp;-x) res+=tree[x];</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sol</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l&gt;r) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>; </span><br><span class="line">	<span class="keyword">while</span> (L&gt;x+<span class="number">1</span>) ADD_Left();</span><br><span class="line">	<span class="keyword">while</span> (R&lt;mid) ADD_Right();</span><br><span class="line">	<span class="keyword">while</span> (L&lt;x+<span class="number">1</span>) DEL_Left();</span><br><span class="line">	<span class="keyword">while</span> (R&gt;mid) DEL_Right();</span><br><span class="line">	ll now=f[mid]; <span class="keyword">int</span> m=x;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=x;i&lt;=y;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span> (f[i]+num+k&lt;now)&#123; now=f[i]+num+k; m=i;&#125;</span><br><span class="line">		DEL_Left();</span><br><span class="line">	&#125;</span><br><span class="line">	f[mid]=now;</span><br><span class="line">	sol(l,mid<span class="number">-1</span>,x,m); sol(mid+<span class="number">1</span>,r,m,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	solve(l,mid);</span><br><span class="line">	sol(mid+<span class="number">1</span>,r,l,mid);</span><br><span class="line">	solve(mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;p[i]),f[i]=INF;</span><br><span class="line">	L=<span class="number">1</span>; R=<span class="number">0</span>; solve(<span class="number">0</span>,n);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,f[n]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="A-3"><a href="#A-3" class="headerlink" title="A"></a>A</h2><ul>
<li>题目要求我们找到一个边集，使得所有顶点的度数 $\leq 2$，并且所有度数为 $1$ 的顶点都有标记，使得它们的权值和应该尽可能大。</li>
<li>让我们将每个顶点 $v$ 分成两个点 $(v,0)$ 和 $(v,1)$，并在 $(v,0)$ 和 $(v,1)$ 之间添加一条边权为 $0$ 的边。</li>
<li>$(u,v)$ 是白色边，在 $(u,0)$ 和 $(v,0)$ 之间添加一条边权为 $0$ 的边。</li>
<li>$(u,v)$ 是黑色边，在 $(u,1)$ 和 $(v,1)$ 之间添加一条边权为 $0$ 的边。</li>
<li>对于被标记的顶点 $v$，创建一个顶点 $(v,2)$，并在 $(v,2)$ 和 $(v,0)$ 之间以及 $(v,2)$ 和 $(v,1)$ 之间添加边，权重为 $w_v$。</li>
<li>直接最大权最大匹配即可。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DIST(e) (lab[e.u]+lab[e.v]-g[e.u][e.v].w*2)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1023</span>,INF=<span class="number">1e6</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> u,v,w;</span><br><span class="line">&#125; g[N][N];</span><br><span class="line"><span class="keyword">int</span> n,m,k,n_x,lab[N],match[N],slack[N],st[N],pa[N],flower_from[N][N],S[N],vis[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; flower[N];</span><br><span class="line"><span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">Getchar</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">char</span> now[<span class="number">1</span>&lt;&lt;<span class="number">20</span>],*S,*T;</span><br><span class="line">	<span class="keyword">if</span> (T==S)&#123;</span><br><span class="line">		T=(S=now)+fread(now,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">20</span>,<span class="built_in">stdin</span>);</span><br><span class="line">		<span class="keyword">if</span> (T==S) <span class="keyword">return</span> EOF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> *S++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">char</span> ch=Getchar();</span><br><span class="line">	<span class="keyword">while</span> (ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>;</span><br><span class="line">		ch=Getchar();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (ch&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;ch&gt;=<span class="string">&#x27;0&#x27;</span>) x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>,ch=Getchar();</span><br><span class="line">	<span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_slack</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!slack[x]||DIST(g[u][x])&lt;DIST(g[slack[x]][x])) slack[x]=u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_slack</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	slack[x]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">1</span>;u&lt;=n;++u)</span><br><span class="line">		<span class="keyword">if</span> (g[u][x].w&gt;<span class="number">0</span>&amp;&amp;st[u]!=x&amp;&amp;S[st[u]]==<span class="number">0</span>) update_slack(u,x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">q_push</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x&lt;=n) <span class="keyword">return</span> q.push_back(x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;(<span class="keyword">int</span>)flower[x].size();i++) q_push(flower[x][i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_st</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	st[x]=b;</span><br><span class="line">	<span class="keyword">if</span> (x&lt;=n) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;(<span class="keyword">int</span>)flower[x].size();++i) set_st(flower[x][i],b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_pr</span><span class="params">(<span class="keyword">int</span> b,<span class="keyword">int</span> xr)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> pr=find(flower[b].begin(),flower[b].end(),xr)-flower[b].begin();</span><br><span class="line">	<span class="keyword">if</span> (pr%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">		reverse(flower[b].begin()+<span class="number">1</span>,flower[b].end());</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">int</span>)flower[b].size()-pr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> pr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_match</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	match[u]=g[u][v].v;</span><br><span class="line">	<span class="keyword">if</span> (u&lt;=n) <span class="keyword">return</span>;</span><br><span class="line">	Edge e=g[u][v];</span><br><span class="line">	<span class="keyword">int</span> xr=flower_from[u][e.u],pr=get_pr(u,xr);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;pr;++i) set_match(flower[u][i],flower[u][i^<span class="number">1</span>]);</span><br><span class="line">	set_match(xr,v);</span><br><span class="line">	rotate(flower[u].begin(),flower[u].begin()+pr,flower[u].end());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> xnv=st[match[u]];</span><br><span class="line">	set_match(u,v);</span><br><span class="line">	<span class="keyword">if</span> (!xnv) <span class="keyword">return</span>;</span><br><span class="line">	set_match(xnv,st[pa[xnv]]);</span><br><span class="line">	augment(st[pa[xnv]],xnv);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_lca</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> t=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (++t;u||v;swap(u,v))&#123;</span><br><span class="line">		<span class="keyword">if</span> (u==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span> (vis[u]==t) <span class="keyword">return</span> u;</span><br><span class="line">		vis[u]=t;</span><br><span class="line">		u=st[match[u]];</span><br><span class="line">		<span class="keyword">if</span> (u) u=st[pa[u]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_blossom</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> lca,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> b=n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b&lt;=n_x&amp;&amp;st[b]) ++b;</span><br><span class="line">	<span class="keyword">if</span> (b&gt;n_x) ++n_x;</span><br><span class="line">	lab[b]=<span class="number">0</span>,S[b]=<span class="number">0</span>;</span><br><span class="line">	match[b]=match[lca];</span><br><span class="line">	flower[b].clear();</span><br><span class="line">	flower[b].push_back(lca);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x=u,y;x!=lca;x=st[pa[y]])</span><br><span class="line">		flower[b].push_back(x),flower[b].push_back(y=st[match[x]]),q_push(y);</span><br><span class="line">	reverse(flower[b].begin()+<span class="number">1</span>,flower[b].end());</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x=v,y;x!=lca;x=st[pa[y]])</span><br><span class="line">		flower[b].push_back(x),flower[b].push_back(y=st[match[x]]),q_push(y);</span><br><span class="line">	set_st(b,b);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n_x;++x) g[b][x].w=g[x][b].w=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n;++x) flower_from[b][x]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;(<span class="keyword">int</span>)flower[b].size();++i)&#123;</span><br><span class="line">		<span class="keyword">int</span> xs=flower[b][i];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n_x;++x)</span><br><span class="line">			<span class="keyword">if</span> (g[b][x].w==<span class="number">0</span>||DIST(g[xs][x])&lt;DIST(g[b][x]))</span><br><span class="line">				g[b][x]=g[xs][x],g[x][b]=g[x][xs];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n;++x)</span><br><span class="line">			<span class="keyword">if</span> (flower_from[xs][x]) flower_from[b][x]=xs;</span><br><span class="line">	&#125;</span><br><span class="line">	set_slack(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">expand_blossom</span><span class="params">(<span class="keyword">int</span> b)</span></span>&#123;<span class="comment">//S[b]==1</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;(<span class="keyword">int</span>)flower[b].size();++i)</span><br><span class="line">		set_st(flower[b][i],flower[b][i]);</span><br><span class="line">	<span class="keyword">int</span> xr=flower_from[b][g[b][pa[b]].u],pr=get_pr(b,xr);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;pr;i+=<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> xs=flower[b][i],xns=flower[b][i+<span class="number">1</span>];</span><br><span class="line">		pa[xs]=g[xns][xs].u;</span><br><span class="line">		S[xs]=<span class="number">1</span>,S[xns]=<span class="number">0</span>;</span><br><span class="line">		slack[xs]=<span class="number">0</span>,set_slack(xns);</span><br><span class="line">		q_push(xns);</span><br><span class="line">	&#125;</span><br><span class="line">	S[xr]=<span class="number">1</span>,pa[xr]=pa[b];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=pr+<span class="number">1</span>;i&lt;(<span class="keyword">int</span>)flower[b].size();++i)&#123;</span><br><span class="line">		<span class="keyword">int</span> xs=flower[b][i];</span><br><span class="line">		S[xs]=<span class="number">-1</span>,set_slack(xs);</span><br><span class="line">	&#125;</span><br><span class="line">	st[b]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">on_found_Edge</span><span class="params">(<span class="keyword">const</span> Edge &amp;e)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> u=st[e.u],v=st[e.v];</span><br><span class="line">	<span class="keyword">if</span> (S[v]==<span class="number">-1</span>)&#123;</span><br><span class="line">		pa[v]=e.u,S[v]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span> nu=st[match[v]];</span><br><span class="line">		slack[v]=slack[nu]=<span class="number">0</span>;</span><br><span class="line">		S[nu]=<span class="number">0</span>,q_push(nu);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (S[v]==<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> lca=get_lca(u,v);</span><br><span class="line">		<span class="keyword">if</span> (!lca) <span class="keyword">return</span> augment(u,v),augment(v,u),<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">else</span> add_blossom(u,lca,v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">matching</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fill(S,S+n_x+<span class="number">1</span>,<span class="number">-1</span>),fill(slack,slack+n_x+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	q.clear();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n_x;++x)</span><br><span class="line">		<span class="keyword">if</span> (st[x]==x&amp;&amp;!match[x]) pa[x]=<span class="number">0</span>,S[x]=<span class="number">0</span>,q_push(x);</span><br><span class="line">	<span class="keyword">if</span> (q.empty()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (;;)&#123;</span><br><span class="line">		<span class="keyword">while</span> (q.size())&#123;</span><br><span class="line">			<span class="keyword">int</span> u=q.front();</span><br><span class="line">			q.pop_front();</span><br><span class="line">			<span class="keyword">if</span> (S[st[u]]==<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> v=<span class="number">1</span>;v&lt;=n;++v)</span><br><span class="line">				<span class="keyword">if</span> (g[u][v].w&gt;<span class="number">0</span>&amp;&amp;st[u]!=st[v])&#123;</span><br><span class="line">					<span class="keyword">if</span> (DIST(g[u][v])==<span class="number">0</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span> (on_found_Edge(g[u][v])) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> update_slack(u,st[v]);</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> d=<span class="number">1e9</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b=n+<span class="number">1</span>;b&lt;=n_x;++b)</span><br><span class="line">			<span class="keyword">if</span> (st[b]==b&amp;&amp;S[b]==<span class="number">1</span>) d=min(d,lab[b]/<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n_x;++x)</span><br><span class="line">			<span class="keyword">if</span> (st[x]==x&amp;&amp;slack[x])&#123;</span><br><span class="line">				<span class="keyword">if</span> (S[x]==<span class="number">-1</span>) d=min(d,DIST(g[slack[x]][x]));</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (S[x]==<span class="number">0</span>) d=min(d,DIST(g[slack[x]][x])/<span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">1</span>;u&lt;=n;++u)&#123;</span><br><span class="line">			<span class="keyword">if</span> (S[st[u]]==<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span> (lab[u]&lt;=d) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">				lab[u]-=d;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (S[st[u]]==<span class="number">1</span>) lab[u]+=d;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b=n+<span class="number">1</span>;b&lt;=n_x;++b)</span><br><span class="line">			<span class="keyword">if</span> (st[b]==b)&#123;</span><br><span class="line">				<span class="keyword">if</span> (S[st[b]]==<span class="number">0</span>) lab[b]+=d*<span class="number">2</span>;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (S[st[b]]==<span class="number">1</span>) lab[b]-=d*<span class="number">2</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		q.clear();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=n_x;++x)</span><br><span class="line">			<span class="keyword">if</span> (st[x]==x&amp;&amp;slack[x]&amp;&amp;st[slack[x]]!=x&amp;&amp;DIST(g[slack[x]][x])==<span class="number">0</span>)</span><br><span class="line">				<span class="keyword">if</span> (on_found_Edge(g[slack[x]][x])) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b=n+<span class="number">1</span>;b&lt;=n_x;++b)</span><br><span class="line">			<span class="keyword">if</span> (st[b]==b&amp;&amp;S[b]==<span class="number">1</span>&amp;&amp;lab[b]==<span class="number">0</span>) expand_blossom(b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">pair&lt;ll,int&gt; weight_blossom()&#123;</span><br><span class="line">	fill(match,match+n+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	n_x=n;</span><br><span class="line">	<span class="keyword">int</span> n_matches=<span class="number">0</span>;</span><br><span class="line">	ll tot_weight=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">0</span>;u&lt;=n;++u) st[u]=u,flower[u].clear();</span><br><span class="line">	<span class="keyword">int</span> w_max=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">1</span>;u&lt;=n;++u)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> v=<span class="number">1</span>;v&lt;=n;++v)&#123;</span><br><span class="line">			flower_from[u][v]=(u==v?u:<span class="number">0</span>);</span><br><span class="line">			w_max=max(w_max,g[u][v].w);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">1</span>;u&lt;=n;++u) lab[u]=w_max;</span><br><span class="line">	<span class="keyword">while</span> (matching()) ++n_matches;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">1</span>;u&lt;=n;++u)</span><br><span class="line">		<span class="keyword">if</span> (match[u]&amp;&amp;match[u]&lt;u)</span><br><span class="line">			tot_weight+=g[u][match[u]].w;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">make_pair</span>(tot_weight,n_matches);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=read(); m=read();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u=<span class="number">1</span>;u&lt;=n+n+n;++u)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> v=<span class="number">1</span>;v&lt;=n+n+n;++v)</span><br><span class="line">			g[u][v]=Edge&#123;u,v,<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		g[i][i+n].w=INF*<span class="number">2</span>;</span><br><span class="line">		g[i+n][i].w=INF*<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,u,v,w;i&lt;m;++i)&#123;</span><br><span class="line">		u=read(); v=read(); w=read();</span><br><span class="line">		g[u+w*n][v+w*n].w=INF*<span class="number">2</span>;</span><br><span class="line">		g[v+w*n][u+w*n].w=INF*<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	k=read();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>,x,v;i&lt;=k;++i)&#123;</span><br><span class="line">		x=read(); v=read();</span><br><span class="line">		g[x][x+n+n].w=max(INF+v,g[x][x+n+n].w);</span><br><span class="line">		g[x+n+n][x].w=max(INF+v,g[x+n+n][x].w);</span><br><span class="line">		g[x+n][x+n+n].w=max(INF+v,g[x][x+n+n].w);</span><br><span class="line">		g[x+n+n][x+n].w=max(INF+v,g[x+n+n][x].w);</span><br><span class="line">	&#125; </span><br><span class="line">	n=n+n+n;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;weight_blossom().first%INF&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="day10"><a href="#day10" class="headerlink" title="day10"></a>day10</h1><h2 id="C-3"><a href="#C-3" class="headerlink" title="C"></a>C</h2><ul>
<li>一次操作可能对区间内的数没有实质性的改变，我们可以维护区间的数是否相同，如果相同则记录那个数，不同则记录为0。</li>
<li>那么若 相同的数|修改的值，那么说明本次修改对区间没有贡献，可以直接返回。</li>
<li>但是这个算法对于 2424242424242 这样的序列，修改的值为 $4,8,16\cdots$ 要递归到叶子节点才能返回，而且对序列没有任何改变。</li>
<li>所以我们可以不维护区间相同的数，记录区间的 $lcm$，对于某次修改如果 $lcm$|修改的值，那么本次修改对区间无贡献。可以直接返回。</li>
<li>注意 $lcm&gt;10^{18}$ 要特判。题解详细分析了复杂度，说明了复杂度是 $O((nw+m)(w+\log n))$ 的。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************************</span></span><br><span class="line"><span class="comment">	Problem:lxl题2</span></span><br><span class="line"><span class="comment">	Author:hydd</span></span><br><span class="line"><span class="comment">	Date:2020/8/6</span></span><br><span class="line"><span class="comment">*********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls now&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs now&lt;&lt;1|1</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> uint;</span><br><span class="line"><span class="keyword">const</span> uint lim=<span class="number">-1u</span>;</span><br><span class="line"><span class="keyword">const</span> ull INF=<span class="number">2e18</span>;</span><br><span class="line"><span class="keyword">int</span> n,q;</span><br><span class="line">ull a[<span class="number">1610000</span>],tag[<span class="number">1610000</span>];</span><br><span class="line">uint sum[<span class="number">1610000</span>];</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">Getchar</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> now[<span class="number">1</span>&lt;&lt;<span class="number">20</span>],*S,*T;</span><br><span class="line">    <span class="keyword">if</span> (T==S)&#123;</span><br><span class="line">        T=(S=now)+fread(now,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">20</span>,<span class="built_in">stdin</span>);</span><br><span class="line">        <span class="keyword">if</span> (T==S) <span class="keyword">return</span> EOF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *S++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> ch=Getchar();</span><br><span class="line">    <span class="keyword">while</span> (ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>;</span><br><span class="line">        ch=Getchar();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (ch&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;ch&gt;=<span class="string">&#x27;0&#x27;</span>) x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>,ch=Getchar();</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ull <span class="title">readull</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ull x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> ch=Getchar();</span><br><span class="line">    <span class="keyword">while</span> (ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) ch=Getchar();</span><br><span class="line">    <span class="keyword">while</span> (ch&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;ch&gt;=<span class="string">&#x27;0&#x27;</span>) x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>,ch=Getchar();</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ull <span class="title">gcd</span><span class="params">(ull a,ull b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">return</span> gcd(b,a%b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ull <span class="title">lcm</span><span class="params">(ull x,ull y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x==INF||y==INF) <span class="keyword">return</span> INF;</span><br><span class="line">	ull g=gcd(x,y); x/=g;</span><br><span class="line">	<span class="keyword">if</span> (x&gt;INF/y+<span class="number">1</span>) <span class="keyword">return</span> INF;</span><br><span class="line">	<span class="keyword">if</span> (x*y&gt;=INF) <span class="keyword">return</span> INF;</span><br><span class="line">	<span class="keyword">return</span> x*y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    sum[now]=sum[ls]+sum[rs];</span><br><span class="line">    tag[now]=lcm(tag[ls],tag[rs]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        tag[now]=a[l];</span><br><span class="line">        sum[now]=tag[now]&amp;lim;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(ls,l,mid); build(rs,mid+<span class="number">1</span>,r);</span><br><span class="line">    pushup(now);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y,ull v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        tag[now]=gcd(tag[now],v);</span><br><span class="line">        sum[now]=tag[now]&amp;lim;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (v%tag[now]) tag[now]=gcd(tag[now],v);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=mid) change(now&lt;&lt;<span class="number">1</span>,l,mid,x,y,v);</span><br><span class="line">    <span class="keyword">if</span> (y&gt;mid) change(now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,y,v);</span><br><span class="line">    pushup(now);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">uint <span class="title">query</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y) <span class="keyword">return</span> sum[now];</span><br><span class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>; uint res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=mid) res+=query(now&lt;&lt;<span class="number">1</span>,l,mid,x,y);</span><br><span class="line">    <span class="keyword">if</span> (y&gt;mid) res+=query(now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n=read(); q=read();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) a[i]=readull();</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">int</span> op,l,r; ull x;</span><br><span class="line">    <span class="keyword">while</span> (q--)&#123;</span><br><span class="line">        op=read(); l=read(); r=read();</span><br><span class="line">        <span class="keyword">if</span> (op==<span class="number">1</span>)&#123;</span><br><span class="line">            x=readull();</span><br><span class="line">            change(<span class="number">1</span>,<span class="number">1</span>,n,l,r,x);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>,query(<span class="number">1</span>,<span class="number">1</span>,n,l,r));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">hydd</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2020/08/07/sol_11/">http://example.com/2020/08/07/sol_11/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/08/11/sol_8/"><i class="fa fa-chevron-left">  </i><span>20200811 模拟赛题解</span></a></div><div class="next-post pull-right"><a href="/2020/07/26/sol_12/"><span>20200726 讲课</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1601458971422&amp;di=b8daa23ca0b94063c28207d10326c892&amp;imgtype=0&amp;src=http%3A%2F%2Fattach.bbs.miui.com%2Fforum%2F201412%2F14%2F202225id4jvijttjt6ffjs.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 By hydd</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.8.2"></script><script src="/js/fancybox.js?version=1.8.2"></script><script src="/js/sidebar.js?version=1.8.2"></script><script src="/js/copy.js?version=1.8.2"></script><script src="/js/fireworks.js?version=1.8.2"></script><script src="/js/transition.js?version=1.8.2"></script><script src="/js/scroll.js?version=1.8.2"></script><script src="/js/head.js?version=1.8.2"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>